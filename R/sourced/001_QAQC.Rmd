---
title: ''
output: html_document
---


## About  

This section has tables and graphs, in separate tabs.  

Anything we definitely want to show up here in the explanation?  


<details>
<summary>Kim's to-dos</summary>

Tasks to address from analysis plan:  

+  QAQC flag summary - make it obvious if there are any 1s or -3s in the dataset  
+  Something to check percent cover standardization (e.g., max. cover).  
+  Remove plots that haven't been sampled at least X # of times (currently X = 3) - but maybe wait until analysis step to do this, so they show up in stacked and spatial bar charts?    
+  Remove flagged data. Make row in input spreadsheet so user can specify which flagged data to remove. Modify function to use user's input (rather than my hard-coded -3)  


Need to do something about NMST abiotic categories, unknown species, unvegetated, etc.  

Probably want data frames by:  

-  species (original)  
-  vegetation group  
-  with custom metrics  


Tasks from analysis plan that have been addressed in this .Rmd:  

+  Identify rows of missing data (plots not measured)  
+  table of plots ~ year  

</details>

## Missing/Removed Data  

### Plots/dates without samples  

There were **`r nrow(unsampds)` rows** with no data. These rows were removed from the dataset before further processing. If rows were removed, relevant information is in a table below.   

```{r}
if(nrow(unsampds) > 0){
    unsampds %>% 
        DT::datatable(rownames = FALSE,
                      caption = "Plots/Dates with no sampling information") 
}
```



### Data flagged suspect or reject  

There were **`r nrow(susps)` data points** that were removed due to QA/QC flags. If data points were removed, relevant information is in a table below.


```{r, message = FALSE}
if(nrow(susps) > 0){
    susps %>% 
        DT::datatable(rownames = FALSE,
                      caption = "Removed data points") 
}
```


```{r}
# all commented out 7/3/23 because I don't think we'll use it

# # Joining by species category  
# # species group totals 
# cat_sums <- sum_spp_categories(data = dat)
# 
# # join to sampling info, then pivot longer for easier plotting
# dat_summ <- cbind(dat[, 1:which(names(dat) == "Notes")], cat_sums)
# names(dat_summ)[which(is.na(names(dat_summ)))] <- "Other"
# 
# dat_summ_long <- dat_summ %>% 
#     pivot_longer(-(Reserve:Notes),
#                  names_to = "Group",
#                  values_to = "Cover")


```


## Sampling Info  

### Sites and sample dates  

```{r}
table(dat$StTrnsPlt, dat$Year) %>%
    kable(caption = "# samples at each plot in each year") %>%
    kable_styling("striped") %>%
    scroll_box(width = "600px", height = "300px")
```

### Species  

```{r, message = FALSE}
DT::datatable(spp_summ, 
              rownames = FALSE,
              caption = "Species cover and presence per site, across all years. This table is sortable and searchable.")
```


## Time-series, by zone  

### Top 3 species by mean cover across the entire dataset  

```{r, message = FALSE}
plot_through_time(data = top_3_mean,
          group = Species,
          panels = Vegetation_Zone) +
    scale_color_manual(values = palcols_top) +
    ggtitle("Top 3 species by mean cover") +
    theme_bw()
```

### User-chosen species  

```{r}
plot_through_time(data = anaSpec_dfs$univar,
          group = Species_or_Group,
          panels = Vegetation_Zone) +
    scale_color_manual(values = palcols_univar) +
    ggtitle("User-chosen species") +
    theme_bw()
```



## Time-series, all plots combined   

### Top 3 species by mean cover across the entire dataset  

```{r, message = FALSE}
ggplot(top_3_mean, aes(x = Year, y = Cover, 
                     group = Species, color = Species, fill = Species)) +
        geom_jitter(alpha = 0.2) +
        geom_smooth(method = "loess", se = FALSE) +
    scale_color_manual(values = palcols_top) +
    ggtitle("Top 3 species by mean cover, all plots combined") +
    theme_bw()
```

### User-chosen species  

```{r}
ggplot(anaSpec_dfs$univar, aes(x = Year, y = Cover, 
                     group = Species_or_Group, color = Species_or_Group, fill = Species_or_Group)) +
        geom_jitter(alpha = 0.2) +
        geom_smooth(method = "loess", se = FALSE) +
    scale_color_manual(values = palcols_univar) +
    ggtitle("User-chosen species, all plots combined") +
    theme_bw()
```

## Time Series - EIR  

```{r}
ggplot(dat) +
    geom_jitter(aes(x = Year, y = EIR, color = Vegetation_Zone),
                alpha = 0.4) +
    facet_wrap(~Vegetation_Zone) +
    theme(legend.position = "none") +
    theme_bw() +
    labs(title = "EIR by Zone",
         subtitle = "as calculated per plot/date combination")
```



```{r}
ggplot(dat) +
    geom_jitter(aes(x = Year, y = EIR, color = SiteID),
                alpha = 0.4) +
    facet_wrap(~Vegetation_Zone) +
    # theme(legend.position = "none") +
    theme_bw() +
    labs(title = "EIR by Site, within Zone")
```


```{r}
ggplot(dat) +
    geom_histogram(aes(x = EIR, fill = Vegetation_Zone),
                   col = "gray40",
                   binwidth = 0.1) +
    facet_wrap(~Vegetation_Zone) +
    labs(title = "Histogram of EIR by Marsh Zone") +
    theme_bw() +
    theme(legend.position = "none")
```





