---
title: ''
output: html_document
---


## About  

This section has tables and graphs, in separate tabs.  

To detect errors in data sets, the information in this section should be reviewed by Reserve data practitioners. These results are meant to help you find issues that need to be corrected in the raw data, and decide whether plots or data should be removed from analyses (e.g., “off season” surveys, plots no longer monitored, restoration sites).


### Ask yourself:  

-  Do you see the correct number of sampling events per year? If not, what is missing or extra? This implies a correction needs to be made in the raw data file.  
-  Do you see the correct number of plots per site?  
-  Are species names spelled correctly? Are there any close variants or duplicates (e.g., capital vs lowercase, misspelled)?   
-  General percent cover in plots - is anything unusual (e.g., over 100% when standardized, sudden drops or spikes in species)?  




## Missing/Removed Data  

### Plots/dates without samples  

There were **`r nrow(unsampds)` rows** with no data. These rows were removed from the dataset before further processing. If rows were removed, relevant information is in a table below.   

```{r show-unsampleds}
if(nrow(unsampds) > 0){
    unsampds %>% 
        DT::datatable(rownames = FALSE,
                      caption = "Plots/Dates with no sampling information") 
}
```



### Data flagged suspect or reject  

There were **`r nrow(susps)` data points** that were removed due to QA/QC flags. If data points were removed, relevant information is in a table below.


```{r show-flagged, message = FALSE}
if(nrow(susps) > 0){
    susps %>% 
        DT::datatable(rownames = FALSE,
                      caption = "Removed data points") 
}
```


```{r mod-categories}
# all commented out 7/3/23 because I don't think we'll use it

# # Joining by species category  
# # species group totals 
# cat_sums <- sum_spp_categories(data = dat)
# 
# # join to sampling info, then pivot longer for easier plotting
# dat_summ <- cbind(dat[, 1:which(names(dat) == "Notes")], cat_sums)
# names(dat_summ)[which(is.na(names(dat_summ)))] <- "Other"
# 
# dat_summ_long <- dat_summ %>% 
#     pivot_longer(-(Reserve:Notes),
#                  names_to = "Group",
#                  values_to = "Cover")


```


## Sampling Info  

### Sites and sample dates  

```{r show-sampling-info}
table(dat$StTrnsPlt, dat$Year) %>%
    kable(caption = "# samples at each plot in each year") %>%
    kable_styling("striped") %>%
    scroll_box(width = "600px", height = "300px")
```

### Species  

```{r show-species, message = FALSE}
DT::datatable(spp_summ, 
              rownames = FALSE,
              caption = "Species cover and presence per site, across all years. This table is sortable and searchable.")
```


## Time-series - Species 

### By Zone  

#### Top 3 species by mean cover across the entire dataset  

```{r graph-time-top3, message = FALSE}
plot_through_time(data = top_3_mean,
          group = Species,
          panels = Vegetation_Zone) +
    scale_color_manual(values = palcols_top) +
    ggtitle("Top 3 species by mean cover") +
    theme_bw()
```

#### User-chosen species  

```{r graph-time-userChosen}
plot_through_time(data = anaSpec_dfs$univar,
          group = Species_or_Group,
          panels = Vegetation_Zone) +
    scale_color_manual(values = palcols_univar) +
    ggtitle("User-chosen species") +
    theme_bw()
```



### All plots combined  

#### Top 3 species by mean cover across the entire dataset  

```{r graph-time-top3-onePanel, message = FALSE}
ggplot(top_3_mean, aes(x = Year, y = Cover, 
                     group = Species, color = Species, fill = Species)) +
        geom_jitter(alpha = 0.2) +
        geom_smooth(method = "loess", se = FALSE) +
    scale_color_manual(values = palcols_top) +
    ggtitle("Top 3 species by mean cover, all plots combined") +
    theme_bw()
```

#### User-chosen species  

```{r graph-time-userChosen-onePanel}
ggplot(anaSpec_dfs$univar, aes(x = Year, y = Cover, 
                     group = Species_or_Group, color = Species_or_Group, fill = Species_or_Group)) +
        geom_jitter(alpha = 0.2) +
        geom_smooth(method = "loess", se = FALSE) +
    scale_color_manual(values = palcols_univar) +
    ggtitle("User-chosen species, all plots combined") +
    theme_bw()
```

## EIR graphics  

```{r graph-time-EIR}
ggplot(dat) +
    geom_jitter(aes(x = Year, y = EIR, color = Vegetation_Zone),
                alpha = 0.4) +
    facet_wrap(~Vegetation_Zone) +
    theme(legend.position = "none") +
    theme_bw() +
    labs(title = "EIR by Zone",
         subtitle = "as calculated per plot/date combination")
```



```{r graph-time-EIR2}
ggplot(dat) +
    geom_jitter(aes(x = Year, y = EIR, color = SiteID),
                alpha = 0.4) +
    facet_wrap(~Vegetation_Zone) +
    # theme(legend.position = "none") +
    theme_bw() +
    labs(title = "EIR by Site, within Zone")
```


```{r graph-hist-EIR}
ggplot(dat) +
    geom_histogram(aes(x = EIR, fill = Vegetation_Zone),
                   col = "gray40",
                   binwidth = 0.1) +
    facet_wrap(~Vegetation_Zone) +
    labs(title = "Histogram of EIR by Marsh Zone") +
    theme_bw() +
    theme(legend.position = "none")
```





